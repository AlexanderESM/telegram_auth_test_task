<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û—Ç–ª–∞–¥–∫–∞ Telegram WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
        }
        .debug {
            background: #f5f5f5;
            border: 1px solid #ccc;
            padding: 1em;
            margin-top: 2em;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>

<h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="name">–ì–æ—Å—Ç—å</span>!</h1>
<p><strong>ID:</strong> <span id="user-id">???</span></p>
<p><strong>Username:</strong> <span id="username">???</span></p>

<div class="debug" id="debug">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</div>

<script>
    if (Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();

        const initData = Telegram.WebApp.initData;
        const now = new Date().toLocaleString();

        try {
            const params = new URLSearchParams(initData);
            const userJson = params.get("user");
            if (userJson) {
                const user = JSON.parse(userJson);
                document.getElementById("name").textContent = user.first_name + " " + (user.last_name || "");
                document.getElementById("user-id").textContent = user.id;
                document.getElementById("username").textContent = user.username || "(–±–µ–∑ username)";
            }
        } catch (e) {
            console.warn("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å initData:", e);
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏–º cookie
        if (initData && !document.cookie.includes("tg_init_data=")) {
            document.cookie = "tg_init_data=" + encodeURIComponent(initData) + "; path=/; SameSite=None; Secure";
        }

        document.getElementById("debug").innerText = `
üïí –í—Ä–µ–º—è: ${now}
üì¶ initData: ${initData || '[–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö]'}
üç™ document.cookie: ${document.cookie || '[cookie –ø—É—Å—Ç]'}
        `;
    } else {
        document.getElementById("debug").innerText = "‚ùå Telegram.WebApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω.";
    }
</script>

</body>
</html>
